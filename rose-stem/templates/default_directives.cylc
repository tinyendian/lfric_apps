{# ########################################################################### #}
{# (c) Crown copyright 2024 Met Office. All rights reserved. #}
{# The file LICENCE, distributed with this code, contains details of the terms #}
{# under which the code may be used. #}
{# ########################################################################### #}
{% do LOG.debug("Entered templates/default_directives.cylc") %}

{% set defaults = {
    "memory": [24, "GB"],
    "wallclock": 20,
    "build_memory": [6, "GB"],
    "build_wallclock": 25,
    "build_cpus": 6,
    "mesh_memory": [6, "GB"],
    "mesh_wallclock": 20,
    "mesh_cpus": 6,
    "tech-tests_memory": [6, "GB"],
    "tech-tests_wallclock": 20,
    "tech-tests_cpus": 1,
    } %}

{% for item, value in defaults.items() %}

    {% set value = default_directives.get(item, value) %}

    {% if task_ns.platform in default_directives %}
        {% set platform_directives = default_directives[task_ns.platform] %}
        {% set value = platform_directives.get(item, value) %}
        {% if task_ns.application in platform_directives %}
            {% set value = platform_directives[task_ns.application].get(item, value) %}
        {% endif %}
    {% endif %}

    {% if item not in task_dict %}
        {% do task_dict.update({item: value}) %}
    {% endif %}

{% endfor %}


{% do LOG.debug("Finished in templates/default_directives.cylc") %}